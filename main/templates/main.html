{% extends 'base.html' %} 

{% block content %}
<head>
    <title>StokBox</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        .container {
            font-family: Poppins, sans-serif;
            width: 90%;
            max-width: 1200px;
            background-color: #f0f0f0;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            margin: 2% auto;
            margin-top: 60px;
        }

        body {
            font-family: Poppins, sans-serif;
            background: linear-gradient(45deg, #a6c0fe, #f68084);
            margin: 0;
            padding: 0;
        }
    
        header {
            font-family: Poppins, sans-serif;
            background: linear-gradient(45deg, #99addc, #f68084);
            color: #fff;
            text-align: center;
            padding: 20px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .navbar {
            position: sticky;
            top: 0;
            width: 100%;
            z-index: 100;
            font-family: Poppins, sans-serif;
            overflow: hidden;
            background-color: #bbc4f0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            margin: 0;
            display: flex;
            justify-content: space-between; /* Mengatur ruang antara elemen di dalam navbar */
            align-items: center; /* Pusatkan vertikal */
        }

        .navbar-left {
            float: left; /* Mengatur elemen ke kiri */
            margin-left: 10px; /* Memberikan jarak dari kiri */
        }


        .navbar-right {
            display: flex;
            gap: 10px; /* Jarak antara tombol-tombol */
        }

        .navbar a {
            font-family: Poppins, sans-serif;
            color: black;
            text-align: center;
            padding: 14px 16px;
            text-decoration: none;
            transition: background-color 0.3s;
        }

        .navbar a:hover {
            text-decoration: underline;
            background-color: transparent;
        }

        .navbar a.active {
            background-color: #d4b4e7;
            color: white;
        }

        .nav-buttons {
            display: flex;
            gap: 10px; /* Jarak antara tombol-tombol */
        }

        table {
            font-family: Poppins, sans-serif;
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
    
        table, th, td {
            font-family: Poppins, sans-serif;
        }
    
        th, td {
            font-family: Poppins, sans-serif;
            padding: 8px;
            text-align: center;
        }
    
        th {
            font-family: Poppins, sans-serif;
            background-color: #f2f2f2;
        }
    
        img {
            max-width: 100%;
            height: auto;
        }
    
        button {
            font-family: Poppins, sans-serif;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }
    
        button:hover {
            opacity: 0.8;
        }
    
        a {
            font-family: Poppins, sans-serif;
            text-decoration: none;
        }

        table tr:last-child {
            background-color: #ecd8fb; 
        }

        #product_table {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            gap: 10px;
        }

        .custom-card {
            width: 100%; /* Atur lebar card menjadi 100% dari lebar kontainer */
            max-width: 300px; /* Atur lebar maksimum card sesuai kebutuhan Anda */
        }


    </style>
</head>
<body>
<div class="navbar">
    <div class="navbar-left">
        <a><b>Welcome, {{ name }}!</b></a>
    </div>
    <div class="navbar-right">
        <a href="{% url 'main:logout' %}">Logout</a>
    </div>
</div>
    
<div class="container">
<header>
    <h1>Selamat Datang, {{ name }} di StokBox!</h1>
    <h4>Kelola Persediaan Buah Anda dengan Lebih Baik di StokBox</h4>
</header>

    <h5>Name:</h5>
    <p>{{ name }}</p>

    <h5>Class:</h5>
    <p>{{ class }}</p><br \>
    
    <div>
        <p><b>Anda telah menyimpan {{ total_products }} produk di StokBox.</b></p>
    </div>
 
    <table id="product_table">   
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">Add New Product</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="form" onsubmit="return false;">
                            {% csrf_token %}
                            <div class="mb-3">
                                <label for="name" class="col-form-label">Name:</label>
                                <input type="text" class="form-control" id="name" name="name"></input>
                            </div>
                            <div class="mb-3">
                                <label for="price" class="col-form-label">Price:</label>
                                <input type="number" class="form-control" id="price" name="price"></input>
                            </div>
                            <div class="mb-3">
                                <label for="amount" class="col-form-label">Stock:</label>
                                <input type="number" class="form-control" id="amount" name="amount"></input>
                            </div>
                            <div class="mb-3">
                                <label for="description" class="col-form-label">Description:</label>
                                <textarea class="form-control" id="description" name="description"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="url" class="col-form-label">URL Picture:</label>
                                <input type="url" class="form-control" id="url" name="url">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="button_add" data-bs-dismiss="modal">Add Product</button>
                    </div>
                </div>
            </div>
        </div>
    </table>
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">Add Product by AJAX</button>
    
    <br />

    
    <h5>Sesi terakhir login: {{ last_login }}</h5>

    <a href="{% url 'main:create_product' %}">
        <button style="background-color: #007bff; color: #fff; padding: 10px 20px; border: 1px solid #007bff; border-radius: 5px; font-size: 16px; cursor: pointer;">
            Add New Product
        </button>
    </a> 
    
    <a href="{% url 'main:logout' %}">
        <button style="background-color: #b70000; color: #fff; padding: 10px 20px; border: 1px solid #eee; border-radius: 5px; font-size: 16px; cursor: pointer;">
            Logout
        </button>
    </a>
</div>

<script>
    console.log('hello');
    const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value

    async function getProducts() {
        console.log('get products');
        const response = await fetch("{% url 'main:get_product_json' %}");
        return await response.json();
    }

    function addStock(pk) {
        const form = new FormData()
        form.append('product_id', pk)

        fetch('/add_stock/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrftoken,
                'mode': 'same-origin'
            },
            body: form
        }).then(res => {console.log('hehe');refreshProducts()})
    }

    function reduceStock(pk) {
        const form = new FormData()
        form.append('product_id', pk)

        fetch('/reduce_stock/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrftoken,
                'mode': 'same-origin'
            },
            body: form
        }).then(res => {console.log('hehe');refreshProducts()})
    }

    function deleteProduct(pk) {
        const form = new FormData()
        form.append('product_id', pk)

        fetch('/delete_product/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrftoken,
                'mode': 'same-origin'
            },
            body: form
        }).then(res => {console.log('hehe');refreshProducts()})
        window.location.reload()
    }
    
    async function refreshProducts() {
        console.log('refresh products');
        document.getElementById("product_table").innerHTML = ""
        const products = await getProducts()

        products.forEach((products) => {
            const card = `
            <div class="col-md-4 mb-4 custom-card">
                <div class="card">
                    <img src="${products.fields.picture}" class="card-img-top" width="100"> 
                    <div class="card-body">
                        <h5 class="card-title">${products.fields.name}</h5>
                        <p class="card-text">${products.fields.description}</p>
                        <p class="card-text">Price: ${products.fields.price}</p>
                        <p class="card-text">Stock: ${products.fields.amount}</p>
                        <p class="card-text">Date Added: ${products.fields.date_added}</p>
                        <a href="edit-product/${products.pk}" class="btn btn-primary" style="margin-bottom: 10px;">Edit</a>
                        <button onclick="addStock(${products.pk})" type="submit" style="background-color: #007bff; color: #fff; padding: 5px 10px; border: none; border-radius: 50%; font-size: 14px; cursor: pointer; width: 40px; height: 40px; margin-right: 10px;">
                            +
                        </button>
                        <button onclick="reduceStock(${products.pk})" type="submit" style="background-color: #007bff; color: #fff; padding: 5px 10px; border: none; border-radius: 50%; font-size: 14px; cursor: pointer; width: 40px; height: 40px; margin-right: 10px;">
                            -
                        </button>
                        <button onclick="deleteProduct(${products.pk})" type="submit" style="background-color: #ff3333; color: #fff; padding: 5px 10px; border: none; border-radius: 5px; font-size: 14px; cursor: pointer; width: 100%; margin-right: 10px;">
                            Delete
                        </button>
                        </div>
                    </div>
                </div>`;
            document.getElementById("product_table").innerHTML += card; // Mengganti productContainer dengan getElementById
        });
    }
    
    function addProduct() {
        console.log('tes');
        const formData = new FormData();
        formData.append('name', document.querySelector('#name').value)
        formData.append('price', document.querySelector('#price').value)
        formData.append('description', document.querySelector('#description').value)
        formData.append('amount', document.querySelector('#amount').value)
        formData.append('picture', document.querySelector('#url').value)
        fetch("{% url 'main:add_product_ajax' %}", {
            method: "POST",
            body: formData
        }).then(() => {
            refreshProducts();
            document.getElementById("form").reset();
        });
        window.location.reload()
    }
    
    document.getElementById("button_add").addEventListener("click", addProduct);
    refreshProducts();
    </script>
{% endblock content %}
</body>









